{
	admin off
	log {
		format console
	}
}

(global_proxy_pass_headers) {
	header_up Host {http.reverse_proxy.upstream.hostport}
	header_up X-Real-IP {remote_host}
	header_up X-Forwarded-Host {http.reverse_proxy.upstream.hostport}
}

(global_proxy_pass) {
    log {
		output stdout
		format console
	}

	handle_path /longpolling/* {
		rewrite * /longpolling{path}
		reverse_proxy http://host.containers.internal:8072 {
			import global_proxy_pass_headers
		}
	}

	handle_path /websocket {
		reverse_proxy http://host.containers.internal:8072 {
			import global_proxy_pass_headers
			header_up Upgrade {>Upgrade}
			header_up Connection {>Connection}
		}
	}

	handle {
		reverse_proxy http://host.containers.internal:8069 {
			import global_proxy_pass_headers
		}
	}
}

http://localhost {
	import global_proxy_pass
}

https://localhost {
	tls /etc/caddy/ssl/localhost.crt /etc/caddy/ssl/localhost.key
	import global_proxy_pass
}
